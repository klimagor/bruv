<!DOCTYPE html>
<html>
<head><title>BRUV</title></head>
<!-- script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script -->
<script src="js/angular.min.js"></script>
<style>
table, th , td {
  border: 1px solid grey;
  border-collapse: collapse;
  padding: 5px;
}
table tr:nth-child(odd) {
  background-color: #f1f1f1;
}
table tr:nth-child(even) {
  background-color: #ffffff;
}
#loading {
  position: absolute;
  top: 0;
  right: 0;
}
.selected {
  background-color: #b0b0ff !important;
}

</style>
<body>

<div ng-app="bruv" ng-controller="changesCtrl">

<h1>BRUV</h1>
<div id="loading" ng-show="isLoading"><h1>LOADING...</h1></div>
<div ng-click="refresh()">Refresh</div>

<table border="1" width="100%">
<tr>
<th ng-click="changeOrderTo('number')">Number</th>
<th>Flags</th>
<th ng-click="changeOrderTo('subject')">Message</th>
<th ng-click="changeOrderTo('project')">Project</th>
<th ng-click="changeOrderTo('owner.name')">User Name</th>
<th ng-click="changeOrderTo('change.diff_url')">URL</th>
<th>Change size</th>
<th/>
<th ng-click="changeOrderTo('bugs')">Bugs</th>
</tr>
<tr ng-hide="hide_{{change.number}}" ng-repeat="change in changes | orderBy:orderField:reversed" ng-class="{'selected': change.number == selectedNumber }" ng-click="setSelected(change.number)">
<td>{{ change.number }}</td>
<td>{{ change.flags }}</td>
<td>{{ change.subject }}</td>
<td>{{ change.project }}</td>
<td>{{ change.owner.name }}</td>
<td><a href="{{change.diff_url}}">{{change.diff_url}}</a></td>
<td>+{{change.currentPatchSet.sizeInsertions}} {{change.currentPatchSet.sizeDeletions}}</td>
<!-- td><a href="/read/{{change.number}}">R</a></td -->
<td ng-click="markAsRead(change.number)">R</td>
<td>{{change.bugs}}</td></tr>
</tr>
</table>
<br/>
 -- Flags: [N]ew, [U]pdated Patch Set, New [C]omments, Relates to a [B]ug, Blue-[P]rint 
<br/><br/>
Total: {{changes.length}} reviews
</div>

<script>
var app = angular.module('bruv', []);
app.controller('changesCtrl', function($scope, $http) {
    $scope.reversed = true
    $scope.changeOrderTo = function(newOrderField) {
        if ($scope.orderField == newOrderField) {
            if ($scope.reversed) {
                $scope.orderField = null
            } else {
                $scope.reversed = true
            }
        } else {
            $scope.orderField = newOrderField;
            $scope.reversed = false
        }
    };
    $scope.markAsRead = function(number) {
        $http.get("read/" + number);
        $scope['hide_' + number] = true;
    };
    $scope.refresh = function() {
        $scope.isLoading = true
        $http.get("list/dragonflow").then(function(response) {
            $scope.changes = response.data;
            $scope.isLoading = false
        });
    };
    $scope.refresh();
    $scope.setSelected = function(number) {
        $scope.selectedNumber = number;
    };
});
</script>

</body>
</html>

